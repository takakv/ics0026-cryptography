\documentclass{homework}

\usepackage{enumitem}
\usepackage{tcolorbox}

\usepackage{tikz}
\usetikzlibrary{positioning,calc}

\newcommand*{\ENC}{\mathsf{Enc}}

\usepackage{listings}

\lstset{
basicstyle=\small\ttfamily,
columns=flexible,
breaklines=true
}

\usepackage{fancyvrb}
\fvset{listparameters=\setlength{\topsep}{0pt}\setlength{\partopsep}{0pt}}

\title{01}
\author{Taaniel Kraavi}
\date{\DTMdate{2024-10-06}}

\begin{document}
\maketitle

\textbf{Organisational details}

\begin{itemize}
  \item Include in your report approximately how long the homework took for you.
  \item If you want feedback on Discord, include your username in your report.
  \item Read through task descriptions carefully.
  \item You may request deadline extensions until 03.10.24 23:59 EEST.
  \item Deadlines are strict: if you do not submit your assignment by the deadline, you fail it.
  \item To pass the course you must pass all homework assignments.
  \item Second chances:
  \begin{itemize}
    \item If I review your assignment before the deadline, I will \emph{always} give you a chance to fix it for the deadline (or with a slight extension).
    Start early!
    \item If I review your assignment after the deadline, I will give you an extension \emph{only} if you have explained what part of your code does not work, and what you did to attempt to fix it.
    Ask questions when you are stuck to avoid risking it!
    \item If I give you an extension, you must still fix your homework by the extended deadline to pass.
    \item If your code does not work but you are not aware of it or have not explained your issues, you fail the homework (if I review it after the deadline).
    Test your code!
    \item If you fail your homework, you can appeal my decision within 3 days of receiving your grade (grade day + 3).
    Write me an email or message me on Discord.
    I will then organise an oral defence for you.
  \end{itemize}
  \item You may share hints with each-other, but no answers/code.
  \item You may ask me questions (I prefer Discord to Moodle/email).
  If your code does not work and you have not asked me any questions, you will have a hard time arguing that you actually tried solving it!
  \item If I catch you plagiarising/copying, I will report you to the faculty and fail you for the course.
\end{itemize}

\newpage

\begin{center}
  Theory tasks
\end{center}

\textbf{Additional instructions}

\begin{itemize}
  \item Submit as a PDF file called \texttt{studentid-01.pdf} where \enquote{studentid} is your 6 letter student ID/username (\enquote{takraa}) for me.
  \item Submit it on Moodle as a standalone file (not as part of the code ZIP).
\end{itemize}

\begin{task}{A little about you}
  What role are you currently working as/what would you like to work as?
  Is or do you anticipate cryptography to be somehow related to your work?
  Was there any specific reason (other than the 6 ECTS) that made you pick this course/what do you hope to gain from it?

  \textit{Just a few sentences (3--4) is fine.}
\end{task}

\begin{task}{Knowing your system}
  What operating system do you use? Give three examples of disk-encryption software supported on your OS (include links).

  Do you use full disk encryption? If not, would you start using it?
\end{task}

\begin{task}{Knowing your tools}
  What programming language do you use most/are you most comfortable in?
  For this language, list the following:
  \begin{enumerate}
    \item Standard library/namespace/module (if any) for getting cryptographic randomness.
    \item Standard library/namespace/module (if any) for encryption.
    \item Three well regarded 3\textsuperscript{rd} party libraries for cryptographic stuff (any kind).
  \end{enumerate}

  Include your sources!
\end{task}

\begin{task}{Cryptographer's Rosetta}
  If your mother tongue is not English, try to find a frequency diagram for your language (as we did for the shift cipher).

  If your mother tongue is English, or you cannot find a diagram for your mother tongue, find a frequency diagram for bigrams (two letter pairs, e.g. \enquote{at}, \enquote{to}, \enquote{no}, \dots) or trigrams.

  Include the source!
\end{task}

\begin{task}{Knowing your processor}
  Benchmark how long it takes for your computer to iterate over the 32-bit space (practice 1). How long would it take for your computer to cover the 128-bit space based on this info? Show your calculations.
\end{task}

\begin{task}{A pledge}
  \enquote{
    I understand that I should not implement my own cryptography for any production system, i.e. for any purpose other than a personal learning challenge.
    I understand also that any implementations done during this course are only for learning purposes, and are not for real world use. I understand that due diligence is crucial.
  }

  \textit{Answer with yes/no.}
\end{task}

\newpage
\setcounter{task}{0}

\begin{center}
  Practical tasks
\end{center}

\textbf{Additional instructions}

\begin{itemize}
  \item I must be able to run your program with Python 3.12 and OpenSSL v3.3.1\footnotemark{}.
  \footnotetext{You may use older versions of Python and OpenSSL as long as you do not use deprecated functionality.}
  \item Do not import any 3\textsuperscript{rd} party module\footnotemark{} not specified in the template files.
  \footnotetext{You may change \texttt{Crypto} to \texttt{Cryptodome} if needed.}
  You are free to import any built-in module.
  If you feel the need to import some other 3\textsuperscript{rd} party module, please check with me beforehand!
  \item Your program must not have any unhandled errors that are dependent on user provided data.
  Print a message and exit with an error code without printing the trace when you encounter a situation that should error.
  However, you need not handle file-based errors, e.g. file read/write errors, although it is good practice to handle them.
  \item Submit on Moodle as a ZIP file called \texttt{code.zip}.
  \item Your Python files must have the same name as the template files but without the \texttt{template} suffix, e.g. \texttt{chacha20\_template.py} becomes \texttt{chacha20.py}.
  \item You may change everything in the template files as long as I can run your program with the CLI arguments specified in the templates.
  \item Your ZIP must have the following structure/contents:
  \begin{Verbatim}
code/
├── aes_ecb_cbc.py
├── chacha20.py
├── key.txt
└── ciphertexts/
    ├── ct-1.bin
    ├── ct-2.bin
    ├── ct-3.bin
    ├── ct-4.bin
    └── ct-5.bin
  \end{Verbatim}
\end{itemize}

\begin{task}{Cryptohack}
  Create an account on \url{https://cryptohack.org/courses/}, and try to finish at least the 10 courses of the \enquote{Introduction to Cryptohack}.
  If you cannot finish the 10 courses, write in your report what tasks you were stuck with and what did you try.

  Include a screenshot of your module completion and your username in the PDF report.

  I do recommend that you to attempt the \enquote{Symmetric Cryptography} module as well, but that is not a mandatory part of the homework.
\end{task}

\begin{task}{AES CBC from ECB}
  Homework template file: \texttt{aes\_ecb\_cbc\_template.py}

  The task is to use a library implementation of AES (you need not implement AES yourself) in ECB mode, and build the CBC mode out of it.
  That is, you must instantiate AES with
  \begin{center}
    \texttt{aes = AES.new(key, AES.MODE\_ECB)}
  \end{center}
  Use the PKCS\#7 padding for messages that do not divide into blocks.
  \begin{tcolorbox}[title=Padding]
    Recall that padding is always added (at least for PKCS) even if the message length is a multiple of the block size.
    If the message length is a multiple of the block size, add an entire block of just padding.
  \end{tcolorbox}

  Your program should take in the key and message from the CLI, and have an optional parameter for the IV (see template).
  The key, message, and IV are provided as hex-encoded on the CLI.

  \begin{tcolorbox}[title=Note]
    In practice, providing secrets (e.g. keys, passwords, etc) directly on the CLI as an argument to a program is a terrible idea, since they typically get logged into your terminal history!
  \end{tcolorbox}

  Additional program requirements:
  \begin{itemize}
    \item If the IV is provided with the CLI, it must use the IV. Else, it must generate a \emph{random} IV.
    \item It must work with any key-size supported by AES.
    \item It must encrypt the provided message and print out the hex-encoded ciphertext (without the IV).
    \item It must support multi-block messages.
    \item It should not crash if a dubious key/IV is provided: handle your errors!
  \end{itemize}

  Example call (with NIST AES MTT data):%
  \begin{Verbatim}
python3 aes_ecb_cbc.py \ 
  4278b840fb44aaa757c1bf04acbe1a3e \
  3c888bbbb1a8eb9f3e9b87acaad986c466e2f7071c83083b8a557971918850e5 \
  --iv 57f02a5c5339daeb0a2908a06ac6393f
  \end{Verbatim}

  Do not remove/modify the \texttt{print} or \texttt{assert} statements in the template!
\end{task}

%Some hints: https://www.pycryptodome.org/src/cipher/aes

%https://www.pycryptodome.org/src/util/util#Crypto.Util.Padding.pad
%https://www.pycryptodome.org/src/util/util#crypto-util-strxor-module

%AES.block_size
%AES.key_size[0]

\begin{task}{ChaCha20 encryption/decryption}
  Homework template file: \texttt{chacha20\_template.py}

  Encrypt the file \texttt{plaintext.txt} $5$ times using ChaCha20 with the same key and output the ciphertext bytes into files \texttt{ct-1.bin}, \texttt{ct-2.bin}, \dots.

  \begin{tcolorbox}[title=Note]
    Make sure that you write the raw ciphertext bytes to the file, and not the bytes of a hex or base64 encoded ciphertext.
  \end{tcolorbox}

  Write the key into a file called \texttt{key.txt} as a hex string, e.g.
  \begin{tcolorbox}[title={\texttt{key.txt}}]
    \texttt{4278b840fb44aa...}
  \end{tcolorbox}

  Write the data needed for the decryption of each file, one hex string per line, into a file named \texttt{decryption.txt}.
  Remember to clear the file at the beginning of each encryption cycle, i.e. there should only be 5 lines in the file.

  Test your program!
  \begin{itemize}
    \item Your program should be able to decrypt all ciphertexts!
    \item Your program should not crash!
  \end{itemize}

  Include the generated files \texttt{ct-\{1-5\}.bin}, \texttt{key.txt}, \texttt{decryption.txt} into your submission ZIP.

  Example call:%
  \begin{Verbatim}
python3 chacha20.py encrypt 4278b840fb44aa... message.txt cts/
  \end{Verbatim}
\end{task}

\end{document}
